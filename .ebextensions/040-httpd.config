files:
  "/etc/httpd/conf.d/rakuichi-rakuza.conf":
    mode: "000644"
    owner: root
    group: root
    encoding: plain
    content: |
      # ガラケーは専用サイトのある旧楽市楽座へ飛ばす
      #----------------------------------------
      RewriteEngine on
      RewriteCond %{HTTP_USER_AGENT} ^(DoCoMo|J-PHONE|KDDI|DDIPOKET|UP\.Browser|J-PHONE|Vodafone|SoftBank).*$ [NC]
      RewriteRule ^(.*)$ http://www2.rakuichi-rakuza.jp/$1 [P,L,QSA]
      ProxyPassReverse / http://www2.rakuichi-rakuza.jp/
      #----------------------------------------
      
      ## Basic認証
      <Location /admin>
          Options -Indexes +FollowSymLinks
          AllowOverride All
      
          AuthUserFile  /deploy/rakuichi-rakuza/fuel/app/conf.d/.htpasswd
          AuthName      "Please Enter Your Password"
          AuthType      Basic
          Require       valid-user
      </Location>

      ## files/以下は無ければS3へリバースプロキシ
      SetEnv proxy-initial-not-pooled 1
      # Reverse Proxy
      ProxyPass /files/ http://s3-ap-northeast-1.amazonaws.com/rakuichi-rakuza-files/
      ProxyPassReverse /files/ http://s3-ap-northeast-1.amazonaws.com/rakuichi-rakuza-files/
      # Cache
      CacheRoot /tmp/cache
      CacheIgnoreCacheControl off
      CacheEnable disk /files
      CacheMinFileSize 0
      CacheMaxFileSize 128000
      CacheDirLevels 5
      CacheDirLength 3

